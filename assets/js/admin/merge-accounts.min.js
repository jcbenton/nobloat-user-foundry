!function(a){"use strict";const b={selectedAccounts:[],primaryAccount:null,accountData:{},init:function(){a("#nbuf-merge-form").length&&(this.bindEvents(),this.checkPreselected())},bindEvents:function(){a("#nbuf-load-accounts").on("click",this.loadAccounts.bind(this)),a("#nbuf-confirm-merge").on("change",this.toggleMergeButton.bind(this)),a("#nbuf-cancel-merge").on("click",this.cancelMerge.bind(this)),a(document).on("click",".nbuf-conflict-option",this.selectConflictOption)},checkPreselected:function(){if(NBUF_Merge.preselected&&NBUF_Merge.preselected.length>0){const a=this;setTimeout(function(){a.loadAccounts()},500)}},loadAccounts:function(){const b=this;if(b.selectedAccounts=a("#nbuf-merge-accounts").val(),!b.selectedAccounts||b.selectedAccounts.length<2)return void alert(NBUF_Merge.i18n.minimum_users);a("#nbuf-load-accounts").prop("disabled",!0).text(NBUF_Merge.i18n.loading),a.post(NBUF_Merge.ajaxurl,{action:"nbuf_load_merge_accounts",nonce:NBUF_Merge.nonce,accounts:b.selectedAccounts},function(c){a("#nbuf-load-accounts").prop("disabled",!1).html('<span class="dashicons dashicons-arrow-right-alt" style="vertical-align: middle;"></span> '+NBUF_Merge.i18n.load_accounts),c.success?(b.accountData=c.data,b.showPrimarySelector()):alert(c.data.message||NBUF_Merge.i18n.error_loading)}).fail(function(){a("#nbuf-load-accounts").prop("disabled",!1).html('<span class="dashicons dashicons-arrow-right-alt" style="vertical-align: middle;"></span> '+NBUF_Merge.i18n.load_accounts),alert(NBUF_Merge.i18n.error_loading)})},showPrimarySelector:function(){const b=this;let c="";a.each(b.accountData.accounts,function(a,d){c+='<div class="nbuf-conflict-option" data-user-id="'+a+'">',c+="<h4>"+b.escapeHtml(d.display_name)+"</h4>",c+="<p><strong>"+NBUF_Merge.i18n.email+":</strong> "+b.escapeHtml(d.user_email)+"<br>",c+="<strong>"+NBUF_Merge.i18n.username+":</strong> "+b.escapeHtml(d.user_login)+"<br>",c+="<strong>"+NBUF_Merge.i18n.user_id+":</strong> "+a+"<br>",c+="<strong>"+NBUF_Merge.i18n.posts+":</strong> "+d.post_count+" | ",c+="<strong>"+NBUF_Merge.i18n.comments+":</strong> "+d.comment_count+"</p>",c+="</div>"}),a("#nbuf-primary-options").html(c),a("#nbuf-primary-selector").slideDown(),a("#nbuf-primary-options .nbuf-conflict-option").on("click",function(){a("#nbuf-primary-options .nbuf-conflict-option").removeClass("selected"),a(this).addClass("selected"),b.primaryAccount=a(this).data("user-id"),b.showEmailConsolidation()})},showEmailConsolidation:function(){const b=this,c=[],d=b.accountData.accounts[b.primaryAccount].user_email;c.push("<strong>"+NBUF_Merge.i18n.primary_email+":</strong> "+b.escapeHtml(d)+' <span class="dashicons dashicons-yes" style="color: #00a32a;"></span>');const e=[];a.each(b.accountData.accounts,function(a,c){a!=b.primaryAccount&&c.user_email!==d&&e.push(c.user_email)}),e.length>0&&c.push("<strong>"+NBUF_Merge.i18n.secondary_email+":</strong> "+b.escapeHtml(e[0]||NBUF_Merge.i18n.none)),e.length>1&&c.push("<strong>"+NBUF_Merge.i18n.tertiary_email+":</strong> "+b.escapeHtml(e[1]||NBUF_Merge.i18n.none)),e.length>2&&c.push('<p class="description" style="color: #d63638;">'+NBUF_Merge.i18n.email_limit_warning+"</p>"),a("#nbuf-email-preview").html("<p>"+c.join("<br>")+"</p>"),a("#nbuf-email-consolidation").slideDown(),setTimeout(function(){b.showConflictResolution()},1e3)},showConflictResolution:function(){const b=this;if(!b.accountData.conflicts||0===b.accountData.conflicts.length)a("#nbuf-conflicts-container").html("<p>"+NBUF_Merge.i18n.no_conflicts+"</p>");else{let c="<p>"+NBUF_Merge.i18n.conflict_instruction+"</p>";a.each(b.accountData.conflicts,function(a,d){c+='<div class="nbuf-conflict-item">',c+="<h4>"+b.escapeHtml(d.label)+"</h4>",c+='<div class="nbuf-conflict-options">',a.each(d.values,function(a,e){if(e){const f=b.accountData.accounts[a].display_name,g=a==b.primaryAccount?" selected":"";c+='<div class="nbuf-conflict-option'+g+'" data-field="'+b.escapeHtml(d.field)+'" data-value="'+b.escapeHtml(e)+'">',c+="<strong>"+b.escapeHtml(f)+":</strong><br>"+b.escapeHtml(e),c+="</div>"}}),c+="</div></div>"}),a("#nbuf-conflicts-container").html(c)}a("#nbuf-conflict-resolution").slideDown(),a("#nbuf-merge-options").slideDown(),a("#nbuf-merge-execute").slideDown()},selectConflictOption:function(){a(this).siblings(".nbuf-conflict-option").removeClass("selected"),a(this).addClass("selected")},toggleMergeButton:function(){a("#nbuf-execute-merge").prop("disabled",!a("#nbuf-confirm-merge").is(":checked"))},cancelMerge:function(a){a.preventDefault(),confirm(NBUF_Merge.i18n.confirm_cancel)&&location.reload()},escapeHtml:function(a){const b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return String(a).replace(/[&<>"']/g,function(a){return b[a]})}};a(document).ready(function(){b.init()})}(jQuery);
