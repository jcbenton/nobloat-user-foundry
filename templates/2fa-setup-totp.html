<div class="nbuf-2fa-setup-wrapper">
	<div class="nbuf-2fa-setup-header">
		<h2>Set Up Authenticator App</h2>
		<p class="nbuf-setup-subtitle">Add an extra layer of security to your account</p>
	</div>

	{success_message}
	{error_message}

	<!-- Collapsible App Info -->
	<details class="nbuf-app-info">
		<summary>
			<span class="nbuf-info-icon">&#9432;</span>
			<strong>Don't have an authenticator app?</strong>
			<span class="nbuf-toggle-hint">Click to see recommendations</span>
		</summary>
		<ul class="nbuf-app-list">
			<li><strong>Google Authenticator</strong> - iOS & Android</li>
			<li><strong>Authy</strong> - iOS & Android</li>
			<li><strong>1Password</strong> - iOS & Android</li>
			<li><strong>Microsoft Authenticator</strong> - iOS & Android</li>
		</ul>
	</details>

	<!-- Main Setup Area - Two Column on Desktop -->
	<div class="nbuf-setup-grid">

		<!-- Left Column: QR Code -->
		<div class="nbuf-setup-column nbuf-qr-column">
			<h3>Scan QR Code</h3>
			<p>Open your authenticator app and scan this code:</p>

			<div class="nbuf-qr-code-container">
				{qr_code}
			</div>

			<div class="nbuf-manual-entry">
				<p class="nbuf-manual-label">Can't scan?</p>
				<div class="nbuf-secret-display">
					<code id="nbuf-secret-key">{secret_key}</code>
					<button type="button" class="nbuf-copy-btn" data-secret="{secret_key}" title="Copy to clipboard">
						<span class="nbuf-copy-icon">&#128203;</span>
					</button>
				</div>
				<p class="nbuf-manual-hint">Enter this key manually in your app</p>
			</div>
		</div>

		<!-- Right Column: Verification -->
		<div class="nbuf-setup-column nbuf-verify-column">
			<h3>Verify Setup</h3>
			<p>Enter the 6-digit code from your app:</p>

			<form method="post" action="{action_url}" class="nbuf-verify-setup-form">
				{nonce_field}
				<input type="hidden" name="nbuf_2fa_setup_totp" value="1">
				<input type="hidden" name="secret" value="{secret_key}">

				<div class="nbuf-code-input-wrapper">
					<input type="text"
						   name="code"
						   id="totp_code"
						   class="nbuf-code-input"
						   placeholder="000000"
						   maxlength="6"
						   pattern="[0-9]{6}"
						   inputmode="numeric"
						   autocomplete="off"
						   required
						   autofocus
						   aria-label="Enter 6-digit verification code">
				</div>

				<button type="submit" class="nbuf-button nbuf-button-primary nbuf-verify-btn">
					Verify & Enable
				</button>
			</form>

			<p class="nbuf-next-note">After enabling, you'll receive backup codes to save securely.</p>
		</div>

	</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
	/* Copy secret to clipboard */
	const copyButton = document.querySelector('.nbuf-copy-btn');
	if (copyButton) {
		copyButton.addEventListener('click', function() {
			const secret = this.getAttribute('data-secret');
			navigator.clipboard.writeText(secret).then(function() {
				copyButton.innerHTML = '<span class="nbuf-copy-icon">&#10003;</span>';
				setTimeout(function() {
					copyButton.innerHTML = '<span class="nbuf-copy-icon">&#128203;</span>';
				}, 2000);
			});
		});
	}
});
</script>
