<div class="nbuf-account-wrapper">

    {messages}

    <!-- Tab Navigation -->
    <div class="nbuf-account-tabs">
        <button type="button" class="nbuf-tab-button nbuf-tab-active" data-tab="account">Account</button>
        <button type="button" class="nbuf-tab-button" data-tab="profile">Profile</button>
        <button type="button" class="nbuf-tab-button" data-tab="password">Password</button>
        {security_tab_button}
        {policies_tab_button}
        <a href="{logout_url}" class="nbuf-tab-logout">Logout</a>
    </div>

    <!-- Account Tab -->
    <div class="nbuf-tab-content nbuf-tab-active" data-tab="account">
        <div class="nbuf-account-section">
            <div class="nbuf-account-layout">
                {profile_photo_section}
                <div class="nbuf-account-details">
                    <div class="nbuf-info-grid">
                        <div class="nbuf-info-label">Username:</div>
                        <div class="nbuf-info-value">{username}</div>

                        <div class="nbuf-info-label">Email:</div>
                        <div class="nbuf-info-value">{email}</div>

                        <div class="nbuf-info-label">Display Name:</div>
                        <div class="nbuf-info-value">{display_name}</div>

                        <div class="nbuf-info-label">Member Since:</div>
                        <div class="nbuf-info-value">{registered_date}</div>

                        <div class="nbuf-info-label">Status:</div>
                        <div class="nbuf-info-value">{status_badges}</div>

                        {expiration_info}
                    </div>
                </div>
            </div>
        </div>

        <!-- Version History Section (conditionally displayed) -->
        {version_history_section}
    </div>

    <!-- Edit Profile Tab -->
    <div class="nbuf-tab-content" data-tab="profile">
        <!-- Profile Sub-tabs -->
        <div class="nbuf-subtabs">
            <button type="button" class="nbuf-subtab-button nbuf-subtab-active" data-subtab="details">Details</button>
            <button type="button" class="nbuf-subtab-button" data-subtab="visibility">Visibility</button>
            {photos_subtab_button}
        </div>

        <!-- Details Sub-tab -->
        <div class="nbuf-subtab-content nbuf-subtab-active" data-subtab="details">
            <div class="nbuf-account-section">
                <form method="post" action="{action_url}" class="nbuf-account-form">
                    {nonce_field}
                    <input type="hidden" name="nbuf_account_action" value="update_profile">
                    <input type="hidden" name="nbuf_active_tab" value="profile">
                    <input type="hidden" name="nbuf_active_subtab" value="details">

                    {profile_fields}

                    <button type="submit" class="nbuf-button nbuf-button-primary">Update Profile</button>
                </form>

                {email_change_section}
            </div>
        </div>

        <!-- Visibility Sub-tab -->
        <div class="nbuf-subtab-content" data-subtab="visibility">
            <div class="nbuf-account-section">
                <form method="post" action="{action_url}" class="nbuf-account-form">
                    {nonce_field_visibility}
                    <input type="hidden" name="nbuf_account_action" value="update_visibility">
                    <input type="hidden" name="nbuf_active_tab" value="profile">
                    <input type="hidden" name="nbuf_active_subtab" value="visibility">

                    {visibility_section}

                    <button type="submit" class="nbuf-button nbuf-button-primary">Update Visibility</button>
                </form>
            </div>
        </div>

        <!-- Photos Sub-tab (conditionally displayed) -->
        {photos_subtab_content}
    </div>

    <!-- Change Password Tab -->
    <div class="nbuf-tab-content" data-tab="password">
        <div class="nbuf-account-section">
            <form method="post" action="{action_url}" class="nbuf-account-form">
                {nonce_field_password}
                <input type="hidden" name="nbuf_account_action" value="change_password">
                <input type="hidden" name="nbuf_active_tab" value="password">

                <div class="nbuf-form-group">
                    <label for="current_password" class="nbuf-form-label">Current Password</label>
                    <input type="password" id="current_password" name="current_password" class="nbuf-form-input" required>
                </div>

                <div class="nbuf-form-group">
                    <label for="new_password" class="nbuf-form-label">New Password</label>
                    <input type="password" id="new_password" name="new_password" class="nbuf-form-input" required>
                    <small class="nbuf-form-help">{password_requirements}</small>
                </div>

                <div class="nbuf-form-group">
                    <label for="confirm_password" class="nbuf-form-label">Confirm New Password</label>
                    <input type="password" id="confirm_password" name="confirm_password" class="nbuf-form-input" required>
                </div>

                <button type="submit" class="nbuf-button nbuf-button-primary">Change Password</button>
            </form>
        </div>
    </div>

    <!-- Security Tab (conditionally displayed if 2FA is available) -->
    {security_tab_content}

    <!-- Policies Tab (conditionally displayed if enabled in settings) -->
    {policies_tab_content}

</div>
